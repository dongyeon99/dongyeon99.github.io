---
layout: post
title: Linux job scheduler "PBS (Portable Batch System)" 사용 및 관리
subtitle: 클러스터 PBS(Portable Batch System) 관리, 사용 하기
categories: [linux]
tags: [Linux, PBS, qsub]
comments: true
---

## 목차
#### 1. Job Script 만들기
#### 2. Job 실행 (qsub)
#### 3. 실행중인 Job 확인 (qstat)
#### 4. 실행중인 Job 삭제 (qdel)
#### 5. Host Server info 확인
#### 6. Job 큐 추가 및 삭제
#### 7. 특정 node 비활성화
#### 8. 확인 명령어
#### 9. 자주 발생하는 Error들

<br/>

## 1. Job Script 만들기
PBS Job Script는 (1) shebang line, (2) PBS command, (3) Job 총 3가지 부분으로 이루어집니다. 
Shebang line 은 작업 스크립트의 쉘 또는 인터프리터를 설정하는 부분으로 보통 sh 또는 bash 와 같은 쉘이나 python 과 같은 인터프리터를 사용할 수 있습니다. 
#PBS로 시작되는 PBS command는 job script에 대한 환경을 설정하기 위해 사용됩니다. 
그리고 마지막으로 수행할 job의 내용을 적어주면 job script는 완성됩니다.

실행할 job의 관리를 쉽게 하기 위해서 PBS command에 대해 자세히 알아볼 필요가 있습니다.

| Command       |                       Explanation                         |
| ------------- | :-------------------------------------------------------: |
| -N {jobname}  | job name을 지정, 지정 시 job list에서 확인하기 용이함.       |
| -o {path}     | 표준 출력(stdout)이 쓰일 경로를 지정                        |
| -e {path}     | 표준 에러(stderr)가 쓰일 경로를 지정                        |
| -q {queue}    | 작업을 제출할 큐(queue)를 지정                              |
| -j oe         | 표준 출력(stdout)에 표준 에러(stderr)를 통합시킨다. 그 반대는 'eo'|
| -l ncpus={n}  | 병렬처리 작업일 경우, 이용하고자 하는 코어의 개수를 지정할 수 있다.|

한 대의 노드에서 실행되는 작업의 수를 제한해야 하는 일이 생길 수 있습니다. 
이 때에는 작업 당 할당시킬 수 있는 cpu 개수를 지정해 주면 노드에서 제한된 수의 작업만 실행되게 할 수 있습니다. 
다음과 같이 자원을 제한할 수 있는 limitation (-l) 옵션을 통해 cpu 의 개수를 4로 해 놓으면, 
4개의 코어를 가진 노드에서는 한 개의 작업만 실행되게 됩니다. -l ncpus=4

#### 예시

```linux
vi test.sh                     # shell script인 test sh파일을 만든다.

#!/bin/sh                      # shebang line 작성
#PBS -N testjob1               # testjob1이라는 job의 name 설정
#PBS -O /home/dong/test.txt    # 작업이 실행되면서 출력되는 표준 출력은 /home/dong 폴더에 test.txt파일로 저장
#PBS -l ndoes=1:ppn=4          # 하나의 노드 (nodes), 프로세서 (ppn) 4개에 할당
cd #PBS_O_WORKDIR              # 스크립트가 실행할 디렉토리로 이동

python3 test.py                # test.py를 python3로 실행
```

이 때 주의할 점은 '#PBS'의 #은 주석이 아니기 때문에 반드시 '#PBS'로 입력하고 명령어를 입력해야 한다. 
'cd #PBS_O_WORKDIR'의 경우, qsub를 실행할 위치로 이동해주는 것이므로, 
만약 하위코드에서 절대경로가 아닌, '상대경로'를 입력한 경우 이 명령어를 넣지 않으면 스크립트가 오작동 할 수 있다.

